#!/usr/bin/env nu

# Caminho do repositório e do binário
let repo_path = "/home/alice/setup"
let binary = $"($repo_path)/bin/setup"

# Função para construir
def build [] {
    print "Building project (build)..."
    ^build
    if $env.LAST_EXIT_CODE != 0 {
        error make { msg: "Build failed" }
    }
}

def main [...args] {
    # Always build before running
    build

    if not ($binary | path exists) {
        error make { msg: $"Binary not found after build: ($binary)" }
    }

    # Executa passando argumentos
    ^$binary ...$args
    # Propaga código de saída
    exit $env.LAST_EXIT_CODE
}
